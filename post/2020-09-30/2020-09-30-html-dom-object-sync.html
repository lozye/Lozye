<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <!-- Begin LozyeFramework.WebEngine SEO tag v2.6.1 -->
<title>html-dom object sync | Lozye</title>
<meta name="generator" content="LozyeFramework.WebEngine v1.0.0" />
<meta property="og:title" content="html-dom object sync" />
<meta property="og:locale" content="cn_ZH" />
<meta name="description" content="通过 html 元素做索引，创建一个根据你的选择器创建一个 object 对象。你可以操作 object 对象来改变对应元素的值，当然你也可以通过改变元素的值来修改 object 对应属性值。这个对象暂时命名为propObject，但是它的名字注定会改变的注意黑字多意。" />
<meta property="og:description" content="通过 html 元素做索引，创建一个根据你的选择器创建一个 object 对象。你可以操作 object 对象来改变对应元素的值，当然你也可以通过改变元素的值来修改 object 对应属性值。这个对象暂时命名为propObject，但是它的名字注定会改变的注意黑字多意。" />
<link rel="canonical" href="https://lozye.github.io/post/2020-09-30/2020-09-30-html-dom-object-sync.html?v=132466883541729739" />
<meta property="og:url" content="https://lozye.github.io/post/2020-09-30/2020-09-30-html-dom-object-sync.html?v=132466883541729739" />
<meta property="og:site_name" content="Lozye" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-30" />
<script type="application/ld+json">{"headline":"html-dom object sync","dateModified":"2020-10-09T11:39:14+08:00","datePublished":"2020-10-09T11:39:14+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://lozye.github.io/post/2020-09-30/2020-09-30-html-dom-object-sync.html?v=132466883541729739"},"url":"https://lozye.github.io/post/2020-09-30/2020-09-30-html-dom-object-sync.html?v=132466883541729739","description":"通过 html 元素做索引，创建一个根据你的选择器创建一个 object 对象。你可以操作 object 对象来改变对应元素的值，当然你也可以通过改变元素的值来修改 object 对应属性值。这个对象暂时命名为propObject，但是它的名字注定会改变的注意黑字多意。","@context":"https://schema.org"}</script>
<!-- End LozyeFramework.WebEngine SEO tag -->
    <link href="https://lozye.github.io/assets/css/web.all.css?v=132466883541729739" rel="stylesheet" />

    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

</head>

<body>
    <div class="x-wapper">
        <div class="x-site">
            <div class="x-site-top"></div>
            <div class="x-site-mid"></div>
            <div class="x-site-footer">
                <p class="x-site-title"><a href="https://lozye.github.io/index.html?v=132466883541729739">Lozye</a></p>
                <p class="x-site-slogan"><a>身处黑夜，心向黎明！</a></p>
                <p class="x-site-slogan"><a href="https://lozye.github.io/list.html?v=132466883541729739">全部文章</a></p>
            </div>
            <div class="x-site-hidden">
                <p><a href="http://www.beian.miit.gov.cn/" target="_blank"></a></p>
                <p></p>
            </div>
        </div>
        <div class="x-main">
            <div class="x-container">
                <div class="x-box grid-box">
                    <div class="grid-box x-box-header">
                        <div class="x-box-title grid-box">html-dom object sync</div>
                        <div class="x-box-date grid-box">2020-09-30</div>
                    </div>
                    <div class="grid-box x-box-markdown markdown-body"> <h2 id="0x1-摘要">0X1 摘要</h2>
<p>通过 html 元素做索引，创建一个根据你的选择器创建一个 object 对象。
你可以操作 object 对象来改变对应元素的值，当然你也可以通过改变元素的值来修改 object 对应属性值。
这个对象暂时命名为 <code>propObject</code> ，但是它的名字注定会改变的<s>注意黑字多意</s>。</p>
<h2 id="0x2-使用">0X2 使用</h2>
<p>它有非常简单的使用方式，默认情况你在监控表单时仅需要</p>
<pre><code class="language-js"><span class="hljs-keyword">var</span> prop = <span class="hljs-keyword">new</span> propObject(<span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&quot;#myform&quot;</span>));</code></pre>
<p>来声明一个<code>propObject</code>对象。
然后你就可以操作<code>from</code>里的<code>input</code>、<code>select</code>元素了。</p>
<h2 id="0x3-样例">0X3 样例</h2>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myform&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a6&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a7&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">var</span> prop = <span class="hljs-keyword">new</span> propObject(<span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&quot;#myform&quot;</span>));
  prop.a6 = <span class="hljs-number">18</span>;
  <span class="hljs-built_in">console</span>.log(prop.get(<span class="hljs-string">&quot;a6&quot;</span>).value);
  <span class="hljs-comment">// &lt; 18</span>
  prop.get(<span class="hljs-string">&quot;a6&quot;</span>).value = <span class="hljs-string">&quot;21&quot;</span>;
  <span class="hljs-built_in">console</span>.log(prop.a6);
  <span class="hljs-comment">// &lt; 21</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<h2 id="0x4-方法说明">0X4 方法说明</h2>
<p><s>其实我有写注释</s></p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>string tostring()</td>
<td>获取此对象中值的 json 文本</td>
</tr>
<tr>
<td>object serialize()</td>
<td>获取此对象中值的 json</td>
</tr>
<tr>
<td>void onchange(name, fn)</td>
<td>属性值变化监听，name 需要监听的属性名，fn 回调</td>
</tr>
<tr>
<td>void onchange(name, fn)</td>
<td>属性值变化监听，name 需要监听的属性名，fn 回调</td>
</tr>
<tr>
<td>void visable(name, show)</td>
<td>使一个对象可见，show 是否可见</td>
</tr>
<tr>
<td>void disable(name, show)</td>
<td>使一个对象可交互，show 是否可交互</td>
</tr>
<tr>
<td>object get(name)</td>
<td>获取对应元素</td>
</tr>
</tbody></table>
<h2 id="0x5-自定义">0X5 自定义</h2>
<p>很多时候<s>并没有</s>，我们需要可扩展，所以选择器是可以通过在实例化时指定 <code>{selectors:[]}</code> 来注入的。</p>
<pre><code class="language-js"><span class="hljs-comment">//interface</span>
{
    <span class="hljs-attr">keySelector</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el</span>) </span>{ },<span class="hljs-comment">//对应元素已什么为key</span>
    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el</span>) </span>{ },<span class="hljs-comment">//get方法</span>
    <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el, value</span>) </span>{ },<span class="hljs-comment">//set方法</span>
    <span class="hljs-attr">query</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_body</span>) </span>{ }<span class="hljs-comment">//需要匹配哪些元素</span>
}</code></pre>
<p>通过实现此 <code>interface</code> <s>大雾</s>，来自定义的注入选择器，那么来看看应用。</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;____id&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a1&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a2&quot;</span>&gt;</span>大笨蛋<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a3&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a4&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a5&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span> propObject(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;____id&quot;</span>), {
        <span class="hljs-attr">selectors</span>: [{
            <span class="hljs-attr">keySelector</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el</span>) </span>{ <span class="hljs-keyword">return</span> _el.getAttribute(<span class="hljs-string">&quot;name&quot;</span>); },
            <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el</span>) </span>{ <span class="hljs-keyword">return</span> _el.innerText; },
            <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el, value</span>) </span>{ _el.innerText = value; },
            <span class="hljs-attr">query</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_body</span>) </span>{ <span class="hljs-keyword">return</span> _body.querySelectorAll(<span class="hljs-string">&quot;div&quot;</span>); }
        }]
    });
    obj.a1 = <span class="hljs-string">&quot;555&quot;</span>;
    obj.a3=obj.a2;
    obj.a2=<span class="hljs-string">&quot;你才是&quot;</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<p>通过自定义的选择器，实现操作div的内部文本</p>
<h2 id="0x6-注意">0X6 注意</h2>
<p>内部是通过 <code>{}</code> 来做 <code>key</code> 映射的，故不支持同 <code>key</code> 节点。</p>
<h2 id="0x7-源码">0X7 源码</h2>
<pre><code class="language-javascript"><span class="hljs-meta">&quot;use strict&quot;</span>;
<span class="hljs-keyword">var</span> propObject = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">/** 默认读取接口 */</span>
  <span class="hljs-keyword">var</span> defaultGetter = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cssSelector</span>) </span>{
      <span class="hljs-keyword">var</span> _cssSelector = cssSelector;
      <span class="hljs-built_in">this</span>.keySelector = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el</span>) </span>{
        <span class="hljs-keyword">return</span> _el.getAttribute(<span class="hljs-string">&quot;name&quot;</span>);
      };
      <span class="hljs-built_in">this</span>.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el</span>) </span>{
        <span class="hljs-keyword">return</span> _el.value;
      };
      <span class="hljs-built_in">this</span>.set = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_el, value</span>) </span>{
        _el.value = value;
      };
      <span class="hljs-built_in">this</span>.query = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_body</span>) </span>{
        <span class="hljs-keyword">return</span> _body.querySelectorAll(_cssSelector);
      };
    };
  })();

  <span class="hljs-comment">/** 双向绑定 */</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body, opt</span>) </span>{
    <span class="hljs-keyword">var</span> prop = {};
    <span class="hljs-keyword">var</span> target = <span class="hljs-built_in">this</span>;

    <span class="hljs-comment">/** 绑定对象 */</span>
    <span class="hljs-keyword">var</span> initialize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">option</span>) </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; option.selectors.length; i++) {
        <span class="hljs-keyword">var</span> getter = option.selectors[i];
        <span class="hljs-keyword">if</span> (
          <span class="hljs-keyword">typeof</span> getter.keySelector != <span class="hljs-string">&quot;function&quot;</span> ||
          <span class="hljs-keyword">typeof</span> getter.get != <span class="hljs-string">&quot;function&quot;</span> ||
          <span class="hljs-keyword">typeof</span> getter.set != <span class="hljs-string">&quot;function&quot;</span> ||
          <span class="hljs-keyword">typeof</span> getter.query != <span class="hljs-string">&quot;function&quot;</span>
        )
          <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">var</span> list = getter.query(body);

        <span class="hljs-keyword">if</span> (!list || list.length == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; list.length; k++) defineProperty(list[k], getter);
      }
      <span class="hljs-comment">//console.log(prop);</span>
    }; <span class="hljs-comment">//end initialize</span>

    <span class="hljs-comment">/** 定义属性 */</span>
    <span class="hljs-keyword">var</span> defineProperty = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el, getter</span>) </span>{
      <span class="hljs-keyword">var</span> name = getter.keySelector(el);
      <span class="hljs-keyword">if</span> (!name || prop[name]) <span class="hljs-keyword">return</span>;
      prop[name] = el;
      <span class="hljs-built_in">Object</span>.defineProperty(target, name, {
        <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">return</span> getter.get(el);
        },
        <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
          getter.set(el, val);
          <span class="hljs-keyword">try</span> {
            el.dispatchEvent(<span class="hljs-keyword">new</span> Event(<span class="hljs-string">&quot;change&quot;</span>));
          } <span class="hljs-keyword">catch</span> (ex) {
            <span class="hljs-built_in">console</span>.log(ex);
          }
        },
      });
    }; <span class="hljs-comment">// end defineProperty</span>

    <span class="hljs-comment">//执行初始化</span>
    initialize(
      opt || {
        <span class="hljs-attr">selectors</span>: [<span class="hljs-keyword">new</span> defaultGetter(<span class="hljs-string">&quot;select&quot;</span>), <span class="hljs-keyword">new</span> defaultGetter(<span class="hljs-string">&quot;input&quot;</span>)],
      }
    );

    <span class="hljs-comment">/** 转化为文本 */</span>
    <span class="hljs-built_in">this</span>.tostring = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-built_in">this</span>.serialize(), <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;\t&quot;</span>);
    }; <span class="hljs-comment">//end toString</span>

    <span class="hljs-comment">/** 序列化对象 */</span>
    <span class="hljs-built_in">this</span>.serialize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> json = {};
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> prop) json[key] = <span class="hljs-built_in">this</span>[key];
      <span class="hljs-keyword">return</span> json;
    }; <span class="hljs-comment">//end serialize</span>

    <span class="hljs-comment">/** 值变化事件 */</span>
    <span class="hljs-built_in">this</span>.onchange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, fn</span>) </span>{
      prop[name].addEventListener(<span class="hljs-string">&quot;change&quot;</span>, fn);
    }; <span class="hljs-comment">//end On</span>

    <span class="hljs-comment">/** 使一个对象可见 */</span>
    <span class="hljs-built_in">this</span>.visable = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, show</span>) </span>{
      prop[name].style.display = show ? <span class="hljs-literal">null</span> : <span class="hljs-string">&quot;none&quot;</span>;
    }; <span class="hljs-comment">//end visable</span>

    <span class="hljs-comment">/** 使一个对象可交互 */</span>
    <span class="hljs-built_in">this</span>.disable = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, show</span>) </span>{
      <span class="hljs-keyword">if</span> (show) prop[name].removeAttribute(<span class="hljs-string">&quot;disabled&quot;</span>);
      <span class="hljs-keyword">else</span> prop[name].setAttribute(<span class="hljs-string">&quot;disabled&quot;</span>, <span class="hljs-string">&quot;disabled&quot;</span>);
    }; <span class="hljs-comment">//end disable</span>

    <span class="hljs-comment">/** 独立的获取元素方法 */</span>
    <span class="hljs-built_in">this</span>.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
      <span class="hljs-keyword">return</span> prop[name];
    }; <span class="hljs-comment">//end  get</span>
  };
})();</code></pre>
 </div>
                    <div class="grid-box x-box-footer">
                        <div class="x-box-line">
                            <div class="grid-box x-box-left">
                                <ul>
                                    
                                    <li><a href="https://lozye.github.io/list.html#js?v=132466883541729739">js</a> </li>
                                    
                                </ul>
                                &nbsp;
                            </div>
                            <div class="grid-box x-box-right">
                                <a href="https://lozye.github.io/list.html?v=132466883541729739">BACK</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="x-footer">
                <div class="x-footer-msg x-noselect grid-box">
                    <ul>
                        <li>
                            <span>
                                product by
                                <a href="https://github.com/lozye" target="_blank">@Lozye</a>
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="x-hidden"></div>
    </div>
</body>

</html>